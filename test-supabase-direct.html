<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Direct Supabase Test</title>
</head>
<body>
    <h1>Direct Supabase Connection Test</h1>
    <button onclick="testDirectFetch()">Test Direct Fetch</button>
    <button onclick="testSupabaseClient()">Test Supabase Client</button>
    <pre id="result" style="background: #f5f5f5; padding: 10px; margin-top: 20px;"></pre>

    <script type="module">
        const SUPABASE_URL = 'https://ttuoomryfewtmotaeigf.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_cZy-mEFHYmbfiw3bawGA9w_N6ebKHyn';
        const TABLE_NAME = 'todos';

        window.testDirectFetch = async function() {
            const resultEl = document.getElementById('result');
            resultEl.textContent = 'Testing direct fetch...\n\n';

            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/${TABLE_NAME}?select=id&limit=1`, {
                    method: 'GET',
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=representation'
                    }
                });

                resultEl.textContent += `Status: ${response.status} ${response.statusText}\n\n`;
                
                if (!response.ok) {
                    const errorText = await response.text();
                    resultEl.textContent += `Error Response:\n${errorText}\n\n`;
                    resultEl.textContent += `Response Headers:\n${JSON.stringify(Object.fromEntries(response.headers), null, 2)}\n`;
                } else {
                    const data = await response.json();
                    resultEl.textContent += `Success! Data:\n${JSON.stringify(data, null, 2)}\n`;
                }
            } catch (err) {
                resultEl.textContent += `Exception:\n${err.message}\n\n${err.stack}`;
            }
        };

        window.testSupabaseClient = async function() {
            const resultEl = document.getElementById('result');
            resultEl.textContent = 'Testing Supabase client...\n\n';

            try {
                const { createClient } = await import('https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm');
                const supabase = createClient(SUPABASE_URL, SUPABASE_KEY, {
                    auth: {
                        persistSession: false,
                        autoRefreshToken: false,
                    },
                });

                const { data, error } = await supabase
                    .from(TABLE_NAME)
                    .select('id')
                    .limit(1);

                if (error) {
                    resultEl.textContent += `Error:\n`;
                    resultEl.textContent += `Code: ${error.code || 'unknown'}\n`;
                    resultEl.textContent += `Message: ${error.message}\n`;
                    resultEl.textContent += `Details: ${error.details || 'none'}\n`;
                    resultEl.textContent += `Hint: ${error.hint || 'none'}\n`;
                    resultEl.textContent += `\nFull Error:\n${JSON.stringify(error, null, 2)}\n`;
                } else {
                    resultEl.textContent += `Success! Data:\n${JSON.stringify(data, null, 2)}\n`;
                }
            } catch (err) {
                resultEl.textContent += `Exception:\n${err.message}\n\n${err.stack}`;
            }
        };
    </script>
</body>
</html>
